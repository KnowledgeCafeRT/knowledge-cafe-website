<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Knowledge CafÃ© POS (Internal)</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&family=Climate+Crisis:wght@400&family=Italiana&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: 'Montserrat', sans-serif; 
      background: #F2EAD9; 
      margin: 0; 
      padding: 0; 
    }
    .pos-wrapper { 
      max-width: 1400px; 
      margin: 20px auto; 
      padding: 0 20px; 
    }
    .pos-header { 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      margin-bottom: 20px; 
      flex-wrap: wrap;
      gap: 15px;
    }
    .pos-header h1 { 
      margin: 0; 
      font-family: 'Climate Crisis', sans-serif;
      font-size: 2rem;
      color: #214598;
      text-transform: uppercase;
    }
    .pos-grid { 
      display: grid; 
      grid-template-columns: 1fr 420px; 
      gap: 24px; 
    }
    .pos-panel { 
      background: #E4D8BD; 
      border-radius: 12px; 
      box-shadow: 0 4px 15px rgba(33, 69, 152, 0.1); 
      padding: 20px; 
      min-height: 600px;
      border: 2px solid rgba(33, 69, 152, 0.1);
    }
    .pos-tabs { 
      display: flex; 
      gap: 8px; 
      margin-bottom: 20px; 
      align-items: center;
    }
    .pos-tab { 
      padding: 12px 20px; 
      border-radius: 10px; 
      background: #F2EAD9; 
      color: #214598; 
      cursor: pointer; 
      border: 2px solid rgba(33, 69, 152, 0.2); 
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.2s;
      font-family: 'Montserrat', sans-serif;
    }
    .pos-tab:hover {
      background: rgba(33, 69, 152, 0.05);
      border-color: #214598;
    }
    .pos-tab.active { 
      background: #214598; 
      color: #FDF7EA; 
      border-color: #214598; 
    }
    .price-mode-btn {
      margin-left: auto;
      background: #214598;
      color: #FDF7EA;
    }
    .price-mode-btn:hover {
      background: rgba(33, 69, 152, 0.8);
    }
    .price-mode-btn i {
      margin-right: 5px;
    }
    .category-row { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 10px; 
      margin-bottom: 20px; 
    }
    .category-btn { 
      padding: 12px 20px; 
      border-radius: 10px; 
      background: #F2EAD9; 
      border: 2px solid rgba(33, 69, 152, 0.2); 
      cursor: pointer; 
      font-weight: 600;
      font-size: 1rem;
      color: #214598;
      transition: all 0.2s;
      font-family: 'Montserrat', sans-serif;
    }
    .category-btn:hover {
      background: rgba(33, 69, 152, 0.05);
      border-color: #214598;
      transform: translateY(-2px);
    }
    .items-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); 
      gap: 10px; 
    }
    .item-card { 
      background: #F2EAD9; 
      border: 2px solid rgba(33, 69, 152, 0.2); 
      border-radius: 10px; 
      padding: 12px; 
      cursor: pointer; 
      transition: all 0.2s;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .item-card:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 4px 12px rgba(33, 69, 152, 0.15);
      border-color: #214598;
    }
    .item-card img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 0.4rem;
    }
    .item-name { 
      font-weight: 600; 
      color: #214598; 
      font-size: 0.9rem;
      margin-bottom: 4px;
      font-family: 'Montserrat', sans-serif;
      line-height: 1.2;
    }
    .item-price { 
      color: #214598; 
      font-weight: 700; 
      font-size: 1rem;
      font-family: 'Montserrat', sans-serif;
    }
    .cart-list { 
      display: flex; 
      flex-direction: column; 
      gap: 10px; 
      max-height: 400px; 
      overflow-y: auto; 
      margin-bottom: 15px; 
      padding-right: 5px;
    }
    .cart-line { 
      display: grid; 
      grid-template-columns: 1fr auto; 
      gap: 12px; 
      align-items: center; 
      padding: 12px; 
      border: 2px solid rgba(33, 69, 152, 0.2); 
      border-radius: 10px; 
      background: #F2EAD9;
    }
    .qty-controls { 
      display: flex; 
      align-items: center; 
      gap: 8px; 
    }
    .qty-btn { 
      padding: 6px 12px; 
      border: 2px solid rgba(33, 69, 152, 0.2); 
      border-radius: 8px; 
      background: #F2EAD9; 
      cursor: pointer; 
      font-weight: 700;
      font-size: 1rem;
      min-width: 36px;
      transition: all 0.2s;
      color: #214598;
      font-family: 'Montserrat', sans-serif;
    }
    .qty-btn:hover {
      background: rgba(33, 69, 152, 0.1);
      border-color: #214598;
    }
    .total-row { 
      display: flex; 
      justify-content: space-between; 
      font-weight: 700; 
      margin-top: 12px; 
      color: #214598; 
      font-size: 1.3rem;
      padding-top: 12px;
      border-top: 2px solid rgba(33, 69, 152, 0.2);
      font-family: 'Montserrat', sans-serif;
    }
    .minor-row { 
      display: flex; 
      justify-content: space-between; 
      margin-top: 6px; 
      color: #214598; 
      font-size: 0.95rem;
      font-family: 'Montserrat', sans-serif;
    }
    .actions { 
      display: flex; 
      gap: 10px; 
      margin-top: 15px; 
    }
    /* Change Calculator Styles */
    .change-calculator {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 2px solid rgba(33, 69, 152, 0.2);
    }
    .change-calculator h4 {
      color: #214598;
      font-size: 1.1rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Montserrat', sans-serif;
    }
    .change-input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 15px;
    }
    .change-input-group label {
      font-weight: 600;
      color: #214598;
      font-size: 0.95rem;
      font-family: 'Montserrat', sans-serif;
    }
    .change-input-group input {
      padding: 12px;
      font-size: 1.2rem;
      border: 2px solid rgba(33, 69, 152, 0.2);
      border-radius: 10px;
      text-align: center;
      font-weight: 600;
      transition: all 0.3s;
      color: #214598;
      background: #F2EAD9;
      font-family: 'Montserrat', sans-serif;
    }
    .change-input-group input:focus {
      outline: none;
      border-color: #214598;
      box-shadow: 0 0 0 3px rgba(33, 69, 152, 0.2);
    }
    .change-input-group input[readonly] {
      background: rgba(33, 69, 152, 0.05);
      color: #214598;
    }
    .quick-amounts {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-top: 8px;
    }
    .quick-btn {
      padding: 10px;
      border: 2px solid rgba(33, 69, 152, 0.2);
      background: #F2EAD9;
      color: #214598;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'Montserrat', sans-serif;
    }
    .quick-btn:hover {
      background: rgba(33, 69, 152, 0.1);
      border-color: #214598;
      color: #214598;
      transform: translateY(-2px);
    }
    .quick-btn:active {
      transform: translateY(0);
    }
    .change-display {
      background: #214598;
      color: #FDF7EA;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      margin-top: 15px;
      display: none;
    }
    .change-display.show {
      display: block;
      animation: popIn 0.3s ease;
    }
    @keyframes popIn {
      0% { transform: scale(0.9); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    .change-label {
      font-size: 1rem;
      opacity: 0.9;
      margin-bottom: 8px;
    }
    .change-amount {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 15px;
    }
    .change-breakdown {
      background: rgba(255,255,255,0.15);
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
    }
    .change-breakdown h3 {
      margin-bottom: 12px;
      font-size: 1rem;
      font-weight: 600;
    }
    .bill-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      margin-bottom: 6px;
      font-size: 1rem;
    }
    .bill-icon {
      font-size: 1.3rem;
      margin-right: 8px;
    }
    .bill-count {
      font-weight: 700;
      font-size: 1.2rem;
    }
      .change-alert {
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 12px;
        display: none;
        font-size: 0.95rem;
        font-weight: 600;
      }
      .change-alert.show {
        display: block;
        animation: slideIn 0.3s ease;
      }
      @keyframes slideIn {
        from { transform: translateY(-10px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
      .change-alert-warning {
        background: #fff3cd;
        color: #856404;
        border-left: 4px solid #ffc107;
      }
      .change-alert-error {
        background: #f8d7da;
        color: #721c24;
        border-left: 4px solid #dc3545;
      }
      .btn-calculate {
        width: 100%;
        margin-top: 10px;
      }
      @media (max-width: 900px) {
        .quick-amounts {
          grid-template-columns: repeat(2, 1fr);
        }
        .change-amount {
          font-size: 2.5rem;
        }
        .change-calculator {
          margin-top: 15px;
          padding-top: 15px;
        }
      }
    .btn-primary { 
      background: #214598; 
      color: #FDF7EA; 
      padding: 14px 20px; 
      border-radius: 51.10px; 
      border: none; 
      cursor: pointer; 
      font-weight: 600; 
      font-size: 1rem;
      flex: 1;
      transition: all 0.2s;
      font-family: 'Montserrat', sans-serif;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .btn-primary:hover {
      background: rgba(33, 69, 152, 0.8);
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(33, 69, 152, 0.3);
    }
    .btn-secondary { 
      background: #E4D8BD; 
      color: #214598; 
      padding: 14px 20px; 
      border-radius: 51.10px; 
      border: 2px solid #214598; 
      cursor: pointer; 
      font-weight: 600;
      transition: all 0.2s;
      font-family: 'Montserrat', sans-serif;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .btn-secondary:hover {
      background: rgba(33, 69, 152, 0.05);
    }
    .queue-columns-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .queue-column {
      display: flex;
      flex-direction: column;
    }
    .queue-column-header {
      font-family: 'Montserrat', sans-serif;
      color: #FDF7EA !important;
      margin: 0 0 15px 0;
      font-size: 1.3rem;
      padding: 12px 16px;
      background: #214598;
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .queue-column-header i {
      color: #FDF7EA;
    }
    .queue-list { 
      display: flex; 
      flex-direction: column; 
      gap: 12px; 
      max-height: 600px; 
      overflow-y: auto; 
      padding-right: 5px;
    }
    @media (max-width: 1200px) {
      .queue-columns-container {
        grid-template-columns: 1fr;
      }
    }
    .queue-card { 
      border: 2px solid rgba(33, 69, 152, 0.2); 
      border-left: 6px solid #214598; 
      border-radius: 10px; 
      padding: 15px; 
      background: #F2EAD9; 
      transition: all 0.2s;
    }
    .queue-card:hover {
      box-shadow: 0 4px 12px rgba(33, 69, 152, 0.15);
    }
    .queue-header {
      margin-bottom: 12px;
    }
    .queue-meta { 
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      color: #214598; 
      font-size: 0.95rem; 
      margin-bottom: 6px;
      font-family: 'Montserrat', sans-serif;
    }
    .status-badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    .queue-items { 
      margin: 12px 0; 
      color: #214598; 
      font-weight: 500;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-family: 'Montserrat', sans-serif;
    }
    .queue-item {
      background: #E4D8BD;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #214598;
    }
    .queue-items-large {
      margin: 15px 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .queue-item-large {
      background: #E4D8BD;
      padding: 14px 18px;
      border-radius: 10px;
      font-size: 1.3rem;
      color: #214598;
      font-weight: 600;
      border-left: 4px solid #214598;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: 'Montserrat', sans-serif;
    }
    .queue-item-large strong {
      color: #214598;
      font-size: 1.4rem;
    }
    .queue-item-qty {
      background: #214598;
      color: #FDF7EA;
      padding: 6px 12px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 1.1rem;
      min-width: 50px;
      text-align: center;
    }
    .queue-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(33, 69, 152, 0.2);
    }
    .queue-total {
      font-size: 1.2rem;
      color: #214598;
      font-weight: 700;
      font-family: 'Montserrat', sans-serif;
    }
    .btn-status {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn-status-primary {
      background: #3b82f6;
      color: white;
    }
    .btn-status-primary:hover {
      background: #2563eb;
      transform: translateY(-2px);
    }
    .btn-status-success {
      background: #10b981;
      color: white;
    }
    .btn-status-success:hover {
      background: #059669;
      transform: translateY(-2px);
    }
    .btn-status-complete {
      background: #214598;
      color: #FDF7EA;
    }
    .btn-status-complete:hover {
      background: rgba(33, 69, 152, 0.8);
      transform: translateY(-2px);
    }
    .btn-status-disabled {
      background: #d1d5db;
      color: #6b7280;
      cursor: not-allowed;
    }
    .pin-gate { 
      position: fixed; 
      inset: 0; 
      background: rgba(0,0,0,0.7); 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      z-index: 10000;
    }
    .pin-card { 
      background: #E4D8BD; 
      padding: 30px; 
      border-radius: 15px; 
      width: 380px; 
      box-shadow: 0 10px 40px rgba(0,0,0,0.3); 
    }
    .pin-card h3 { 
      margin: 0 0 15px; 
      font-family: 'Montserrat', sans-serif;
      font-size: 1.5rem;
      color: #214598;
      font-weight: 600;
    }
    .pin-card p {
      color: #214598;
      margin-bottom: 15px;
      font-family: 'Montserrat', sans-serif;
    }
    .pin-input { 
      width: 100%; 
      padding: 12px; 
      border: 2px solid rgba(33, 69, 152, 0.2); 
      border-radius: 8px; 
      margin-bottom: 15px; 
      font-size: 1.1rem;
      background: #F2EAD9;
      color: #214598;
      font-family: 'Montserrat', sans-serif;
    }
    .pin-input:focus {
      outline: none;
      border-color: #214598;
      box-shadow: 0 0 0 3px rgba(33, 69, 152, 0.2);
    }
    .inline { 
      display: inline-flex; 
      gap: 10px; 
      align-items: center; 
    }
    .pos-panel h3 {
      font-family: 'Montserrat', sans-serif;
      color: #214598;
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 1.3rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    select.btn-secondary {
      padding: 10px 14px;
      border-radius: 8px;
      border: 2px solid rgba(33, 69, 152, 0.2);
      background: #F2EAD9;
      color: #214598;
      font-weight: 600;
      cursor: pointer;
      font-family: 'Montserrat', sans-serif;
    }
    label.inline {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
    }
    input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    @media (max-width: 1024px) {
      .pos-grid {
        grid-template-columns: 1fr;
      }
    }
    /* Milk Selection Modal */
    .milk-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      animation: fadeIn 0.2s ease;
      padding: 20px;
      overflow-y: auto;
    }
    .milk-modal-content {
      background: white;
      border-radius: 15px;
      padding: 30px;
      max-width: 400px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      animation: slideUp 0.3s ease;
      margin: auto;
    }
    .milk-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .milk-modal-header h3 {
      font-family: 'Montserrat', sans-serif;
      color: #214598;
      font-size: 1.5rem;
      margin: 0;
      font-weight: 600;
      text-transform: uppercase;
    }
    .milk-modal-close {
      background: none;
      border: none;
      font-size: 2rem;
      color: #214598;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
    }
    .milk-modal-close:hover {
      background: rgba(33, 69, 152, 0.1);
      color: #214598;
    }
    .milk-options {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .milk-option {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px 20px;
      border: 2px solid rgba(33, 69, 152, 0.2);
      border-radius: 10px;
      background: #F2EAD9;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 1.1rem;
      font-weight: 600;
      color: #214598;
      font-family: 'Montserrat', sans-serif;
    }
    .milk-option:hover {
      background: rgba(33, 69, 152, 0.05);
      border-color: #214598;
      transform: translateY(-2px);
    }
    .milk-option i {
      font-size: 1.5rem;
      color: #214598;
    }
    .cup-options {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .cup-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 15px;
      padding: 16px 20px;
      border: 2px solid rgba(33, 69, 152, 0.2);
      border-radius: 10px;
      background: #F2EAD9;
      cursor: pointer;
      transition: all 0.2s;
    }
    .cup-option i {
      font-size: 1.8rem;
      color: #214598;
    }
    .cup-option .cup-meta {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      font-weight: 600;
      color: #214598;
      font-family: 'Montserrat', sans-serif;
    }
    .cup-option .cup-meta small {
      color: #214598;
      font-weight: 500;
      font-size: 0.9rem;
      opacity: 0.7;
    }
    .cup-option:hover,
    .cup-option.selected {
      background: rgba(33, 69, 152, 0.05);
      border-color: #214598;
      transform: translateY(-2px);
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    /* Payment QR Modal */
    .payment-qr-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      animation: fadeIn 0.2s ease;
      padding: 20px;
      overflow-y: auto;
    }
    .payment-qr-modal-content {
      background: white;
      border-radius: 15px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
      margin: auto;
    }
    .payment-qr-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(33, 69, 152, 0.2);
    }
    .payment-qr-modal-header h3 {
      font-family: 'Montserrat', sans-serif;
      color: #214598;
      font-size: 1.5rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .payment-qr-modal-close {
      background: none;
      border: none;
      font-size: 2rem;
      color: #214598;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
    }
    .payment-qr-modal-close:hover {
      background: rgba(33, 69, 152, 0.1);
      color: #214598;
    }
    .payment-qr-modal-body {
      text-align: center;
    }
    /* Responsive Design */
    @media (max-width: 1400px) {
      .pos-wrapper {
        max-width: 100%;
        padding: 15px 20px;
      }
      .pos-grid {
        gap: 20px;
      }
    }

    @media (max-width: 1180px) {
      body {
        font-size: clamp(0.95rem, 1.6vw, 1.05rem);
      }
      .pos-wrapper {
        max-width: 100%;
        padding: 10px 15px;
      }
      .pos-grid {
        grid-template-columns: 1fr;
      }
      .pos-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .pos-header h1 {
        font-size: 1.75rem;
      }
      .pos-tabs {
        flex-wrap: wrap;
        width: 100%;
      }
      .pos-tab {
        font-size: 0.9rem;
        padding: 10px 16px;
      }
      .pos-panel {
        min-height: auto;
      }
      .items-grid {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      }
      .queue-columns-container {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 900px) {
      .pos-wrapper {
        padding: 10px;
        margin: 10px auto;
      }
      .pos-header h1 {
        font-size: 1.5rem;
      }
      .pos-header {
        gap: 10px;
      }
      .pos-header > div {
        width: 100%;
        flex-direction: column;
        gap: 10px;
      }
      .pos-header button {
        width: 100%;
      }
      .pos-tabs {
        gap: 6px;
      }
      .pos-tab {
        font-size: 0.85rem;
        padding: 8px 12px;
        flex: 1;
        min-width: 0;
      }
      .price-mode-btn {
        margin-left: 0;
        width: 100%;
      }
      .category-row {
        gap: 8px;
      }
      .category-btn {
        font-size: 0.9rem;
        padding: 10px 16px;
        flex: 1;
        min-width: 0;
      }
      .items-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
      }
      .item-card {
        padding: 15px;
      }
      .item-name {
        font-size: 1rem;
      }
      .item-price {
        font-size: 1.1rem;
      }
      .cart-list {
        max-height: 300px;
      }
      .cart-line {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      .qty-controls {
        justify-content: flex-end;
      }
      .total-row {
        font-size: 1.2rem;
      }
      .actions {
        flex-direction: column;
      }
      .btn-primary,
      .btn-secondary {
        width: 100%;
      }
      .queue-column-header {
        font-size: 1.1rem;
        padding: 10px 12px;
      }
      .queue-card {
        padding: 12px;
      }
      .queue-item-large {
        font-size: 1.1rem;
        padding: 12px 15px;
      }
      .queue-item-large strong {
        font-size: 1.2rem;
      }
      .milk-modal-content,
      .payment-qr-modal-content {
        width: 95%;
        padding: 20px;
        max-width: none;
      }
      .milk-options {
        flex-direction: column;
      }
      .milk-option {
        width: 100%;
      }
      .syrup-options {
        grid-template-columns: 1fr !important;
      }
      .cup-options {
        gap: 10px;
      }
      .cup-option {
        padding: 12px 16px;
      }
      .pin-card {
        width: 90%;
        padding: 20px;
      }
    }

    @media (max-width: 600px) {
      body {
        font-size: 0.9rem;
      }
      .pos-wrapper {
        padding: 8px;
        margin: 5px auto;
      }
      .pos-header h1 {
        font-size: 1.3rem;
      }
      .pos-tab {
        font-size: 0.75rem;
        padding: 6px 10px;
      }
      .category-btn {
        font-size: 0.85rem;
        padding: 8px 12px;
      }
      .items-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
      .item-card {
        padding: 12px;
      }
      .item-name {
        font-size: 0.95rem;
      }
      .item-price {
        font-size: 1rem;
      }
      .cart-line {
        padding: 10px;
      }
      .qty-btn {
        padding: 4px 8px;
        font-size: 0.9rem;
        min-width: 32px;
      }
      .total-row {
        font-size: 1.1rem;
      }
      .minor-row {
        font-size: 0.85rem;
      }
      .btn-primary,
      .btn-secondary {
        padding: 12px 16px;
        font-size: 1rem;
      }
      .queue-column-header {
        font-size: 1rem;
      }
      .queue-item-large {
        font-size: 1rem;
        padding: 10px 12px;
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .queue-item-qty {
        align-self: flex-end;
      }
      .queue-footer {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .btn-status {
        width: 100%;
        justify-content: center;
      }
      .milk-modal-content,
      .payment-qr-modal-content {
        padding: 15px;
      }
      .milk-modal-header h3 {
        font-size: 1.3rem;
      }
      .milk-option {
        padding: 12px 15px;
        font-size: 1rem;
      }
      .cup-option {
        padding: 10px 12px;
      }
      .cup-option i {
        font-size: 1.5rem;
      }
      .syrup-options {
        grid-template-columns: 1fr !important;
      }
      .syrup-option {
        width: 100%;
        padding: 12px;
      }
      .pin-card h3 {
        font-size: 1.3rem;
      }
      .pin-input {
        padding: 10px;
        font-size: 1rem;
      }
      input#posCustomerName,
      input#posCustomerEmail {
        font-size: 0.9rem;
        padding: 10px;
      }
    }

    @media (max-width: 400px) {
      .items-grid {
        grid-template-columns: 1fr;
      }
      .pos-tabs {
        flex-direction: column;
      }
      .pos-tab {
        width: 100%;
      }
    }

    /* Landscape orientation for tablets */
    @media (max-width: 1024px) and (orientation: landscape) {
      .pos-grid {
        grid-template-columns: 1fr 380px;
      }
      .cart-list {
        max-height: 250px;
      }
      .queue-list {
        max-height: 400px;
      }
    }

    /* Touch device optimizations */
    @media (hover: none) and (pointer: coarse) {
      .item-card,
      .category-btn,
      .pos-tab,
      .qty-btn,
      .btn-primary,
      .btn-secondary {
        min-height: 44px;
      }
      .milk-option,
      .cup-option {
        min-height: 50px;
      }
    }
  </style>
</head>
<body>
  <div class="pos-wrapper" id="posContent">
    <div class="pos-header">
      <h1>POS - Knowledge CafÃ©</h1>
      <div style="display: flex; gap: 10px; margin-left: auto;">
        <button id="refreshQueueBtn" class="btn-secondary">
          <i class="fas fa-sync-alt"></i> Refresh Queue
        </button>
      </div>
    </div>

    <div class="pos-tabs">
      <button class="pos-tab active" data-tab="new">New In-Person Order</button>
      <button class="pos-tab" data-tab="queue">Order Queue (Online + In-Person)</button>
      <button id="priceModeBtn" class="pos-tab price-mode-btn" data-mode="student">
        <i class="fas fa-tag"></i> Student Prices
      </button>
    </div>

    <div class="pos-grid">
      <div class="pos-panel" id="leftPanel">
        <div id="tabNew">
          <div class="category-row" id="posCategories"></div>
          <div class="items-grid" id="posItems"></div>
        </div>

        <div id="tabQueue" style="display:none;">
          <div class="queue-columns-container">
            <div class="queue-column">
              <h3 class="queue-column-header">
                <i class="fas fa-walk"></i> Walk-in Orders
              </h3>
              <div class="queue-list" id="walkInQueueList"></div>
            </div>
            <div class="queue-column">
              <h3 class="queue-column-header">
                <i class="fas fa-globe"></i> Online Pre-orders
              </h3>
              <div class="queue-list" id="onlineQueueList"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="pos-panel">
        <h3><i class="fas fa-shopping-basket"></i> Current Cart</h3>
        <div class="cart-list" id="cartList"></div>
        <div class="minor-row"><span>Subtotal</span><span id="posSubtotal">â‚¬0.00</span></div>
        <div class="minor-row"><span>Pfand</span><span id="posPfand">â‚¬0.00</span></div>
        <div class="total-row"><span>Total</span><span id="posTotal">â‚¬0.00</span></div>

        <!-- Change Calculator -->
        <div class="change-calculator">
          <h4><i class="fas fa-calculator"></i> Change Calculator</h4>
          <div id="changeAlertArea"></div>
          
          <div class="change-input-group">
            <label>Amount Due (â‚¬)</label>
            <input type="text" id="changeAmountDue" value="0.00" readonly>
          </div>

          <div class="change-input-group">
            <label>Amount Given (â‚¬)</label>
            <input type="number" id="changeAmountGiven" placeholder="0.00" step="0.01" min="0">
            <div class="quick-amounts">
              <button class="quick-btn" onclick="setQuickAmount(10)">â‚¬10</button>
              <button class="quick-btn" onclick="setQuickAmount(20)">â‚¬20</button>
              <button class="quick-btn" onclick="setQuickAmount(50)">â‚¬50</button>
              <button class="quick-btn" onclick="setExactAmount()">Exact</button>
            </div>
          </div>

          <button class="btn-primary btn-calculate" onclick="calculateChange()">
            <i class="fas fa-calculator"></i> Calculate Change
          </button>

          <div id="changeDisplay" class="change-display"></div>
        </div>

        <div style="margin-top:12px;">
          <label style="display:block;color:#214598;margin-bottom:6px;">Customer (optional)</label>
          <input id="posCustomerName" class="pin-input" type="text" placeholder="Name" style="margin-bottom:6px;" />
          <input id="posCustomerEmail" class="pin-input" type="email" placeholder="Email" />
        </div>

        <div class="actions">
          <button id="clearCart" class="btn-secondary"><i class="fas fa-trash"></i> Clear</button>
          <button id="submitOrder" class="btn-primary"><i class="fas fa-check"></i> Submit Order</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Coffee Customization Modal -->
  <div id="milkModal" class="milk-modal" style="display:none;">
    <div class="milk-modal-content" style="max-width: 500px;">
      <div class="milk-modal-header">
        <h3 id="milkModalTitle">Customize Coffee</h3>
        <button class="milk-modal-close" id="milkModalClose">&times;</button>
      </div>
      <div style="padding: 20px;">
        <div style="margin-bottom: 25px;">
          <h4 style="margin: 0 0 12px 0; color: #214598; font-size: 1.1rem;">Choose Milk:</h4>
          <div class="milk-options" style="display: flex; gap: 10px;">
            <button class="milk-option" data-milk="cow" style="flex: 1;">
              <i class="fas fa-mug-hot"></i>
              <span>Cow Milk</span>
            </button>
            <button class="milk-option" data-milk="oat" style="flex: 1;">
              <i class="fas fa-leaf"></i>
              <span>Oat Milk</span>
            </button>
          </div>
        </div>
        <div style="margin-bottom: 25px;">
          <h4 style="margin: 0 0 12px 0; color: #214598; font-size: 1.1rem;">Add Syrup (Optional):</h4>
          <div class="syrup-options" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
            <button class="syrup-option" id="noSyrupOption" data-syrup="" style="grid-column: 1 / -1;">
              <i class="fas fa-times"></i>
              <span>No Syrup</span>
            </button>
            <button class="syrup-option" data-syrup="syrup-vanilla">
              <i class="fas fa-candy-cane"></i>
              <span>Vanilla</span>
            </button>
            <button class="syrup-option" data-syrup="syrup-hazelnut">
              <i class="fas fa-candy-cane"></i>
              <span>Hazelnut</span>
            </button>
            <button class="syrup-option" data-syrup="syrup-pumpkin">
              <i class="fas fa-candy-cane"></i>
              <span>Pumpkin Spice</span>
            </button>
            <button class="syrup-option" data-syrup="syrup-spekuloos">
              <i class="fas fa-candy-cane"></i>
              <span>Spekuloos</span>
            </button>
            <button class="syrup-option" data-syrup="syrup-gingerbread">
              <i class="fas fa-candy-cane"></i>
              <span>Gingerbread</span>
            </button>
          </div>
        </div>
        <div style="margin-bottom: 25px;">
          <h4 style="margin: 0 0 12px 0; color: #214598; font-size: 1.1rem;">Choose Cup Type:</h4>
          <div class="cup-options">
            <button class="cup-option" data-cup="togo" data-label="To Go Cup" data-price-student="0.20" data-price-staff="0.20" data-pfand="false">
              <i class="fas fa-mug-hot"></i>
              <div class="cup-meta">
                <span>To Go Cup</span>
                <small>+â‚¬0.20</small>
              </div>
            </button>
            <button class="cup-option" data-cup="normal" data-label="Normal Cup (Pfand)" data-price-student="2.00" data-price-staff="2.00" data-pfand="true">
              <i class="fas fa-mug-saucer"></i>
              <div class="cup-meta">
                <span>Normal Cup (Pfand)</span>
                <small>+â‚¬2.00 refundable</small>
              </div>
            </button>
          </div>
        </div>
        <button id="addCoffeeToCartBtn" class="btn-primary" style="width: 100%; padding: 14px; font-size: 1.1rem; margin-top: 10px;">
          <i class="fas fa-plus"></i> Add to Cart
        </button>
      </div>
    </div>
  </div>

  <!-- Stripe Terminal Payment Modal -->
  <div id="terminalPaymentModal" class="payment-qr-modal" style="display:none;">
    <div class="payment-qr-modal-content">
      <div class="payment-qr-modal-header">
        <h3><i class="fas fa-credit-card"></i> Payment Processing</h3>
        <button class="payment-qr-modal-close" id="terminalPaymentClose">&times;</button>
      </div>
      <div class="payment-qr-modal-body">
        <div style="text-align: center; margin-bottom: 20px;">
            <p style="font-size: 1.1rem; color: #214598; margin-bottom: 10px;">
            Order: <strong id="terminalOrderId">#00000000</strong>
          </p>
          <p style="font-size: 1.3rem; color: #8b5e3c; font-weight: 700; margin-bottom: 20px;">
            Total: <span id="terminalTotal">â‚¬0.00</span>
          </p>
        </div>
        <div id="terminalStatus">
          <!-- Payment status will be displayed here -->
        </div>
        <div style="margin-top: 20px; padding: 15px; background: #f3ece5; border-radius: 8px; text-align: center;">
          <p style="color: #5c4033; font-size: 0.9rem; margin: 0;">
            <i class="fas fa-info-circle"></i> Order sent to Stripe Terminal device. Customer can tap/swipe card.
          </p>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script src="stripe-config.js"></script>
  <script src="supabase-config.js"></script>
  <script src="session-manager.js"></script>
  <script src="session-check.js"></script>
  <script src="pos.js"></script>
  <script>
    // Close terminal payment modal
    document.getElementById('terminalPaymentClose')?.addEventListener('click', () => {
      document.getElementById('terminalPaymentModal').style.display = 'none';
    });

    // Change Calculator Functions
    window.updateChangeCalculator = function() {
      const totalElement = document.getElementById('posTotal');
      if (totalElement) {
        const totalText = totalElement.textContent.replace('â‚¬', '').replace(',', '').trim();
        const total = parseFloat(totalText) || 0;
        const amountDueInput = document.getElementById('changeAmountDue');
        if (amountDueInput) {
          amountDueInput.value = total.toFixed(2);
          // Clear change display if amount due changed
          const changeDisplay = document.getElementById('changeDisplay');
          if (changeDisplay) {
            changeDisplay.style.display = 'none';
          }
        }
      }
    };

    function setQuickAmount(amount) {
      const amountGivenInput = document.getElementById('changeAmountGiven');
      if (amountGivenInput) {
        amountGivenInput.value = amount.toFixed(2);
        amountGivenInput.focus();
      }
    }

    function setExactAmount() {
      const amountDueInput = document.getElementById('changeAmountDue');
      const amountGivenInput = document.getElementById('changeAmountGiven');
      if (amountDueInput && amountGivenInput) {
        const total = parseFloat(amountDueInput.value) || 0;
        amountGivenInput.value = total.toFixed(2);
        amountGivenInput.focus();
      }
    }

    function calculateChange() {
      const amountDueInput = document.getElementById('changeAmountDue');
      const amountGivenInput = document.getElementById('changeAmountGiven');
      const changeDisplay = document.getElementById('changeDisplay');
      const alertArea = document.getElementById('changeAlertArea');

      if (!amountDueInput || !amountGivenInput || !changeDisplay || !alertArea) return;

      const amountDue = parseFloat(amountDueInput.value) || 0;
      const amountGiven = parseFloat(amountGivenInput.value) || 0;

      // Clear previous alerts
      alertArea.innerHTML = '';

      // Validation
      if (amountGiven === 0) {
        showChangeAlert('Please enter amount given!', 'error');
        changeDisplay.style.display = 'none';
        return;
      }

      if (amountGiven < amountDue) {
        const missing = amountDue - amountGiven;
        showChangeAlert(`âš ï¸ Too little! Still need â‚¬${missing.toFixed(2)}`, 'warning');
        changeDisplay.style.display = 'none';
        return;
      }

      const change = amountGiven - amountDue;

      // Display change
      changeDisplay.innerHTML = `
        <div class="change-label">Change</div>
        <div class="change-amount">â‚¬${change.toFixed(2)}</div>
        ${change > 0 ? renderChangeBreakdown(change) : '<p style="opacity: 0.8;">Exact amount - No change!</p>'}
      `;
      
      changeDisplay.style.display = 'block';
      changeDisplay.classList.add('show');

      // Play success sound (optional)
      playChangeSound();
    }

    function renderChangeBreakdown(amount) {
      const denominations = [
        { value: 50, label: 'â‚¬50 Bill', icon: 'ðŸ’µ' },
        { value: 20, label: 'â‚¬20 Bill', icon: 'ðŸ’µ' },
        { value: 10, label: 'â‚¬10 Bill', icon: 'ðŸ’µ' },
        { value: 5, label: 'â‚¬5 Bill', icon: 'ðŸ’µ' },
        { value: 2, label: 'â‚¬2 Coin', icon: 'ðŸª™' },
        { value: 1, label: 'â‚¬1 Coin', icon: 'ðŸª™' },
        { value: 0.50, label: '50 Cent', icon: 'ðŸª™' },
        { value: 0.20, label: '20 Cent', icon: 'ðŸª™' },
        { value: 0.10, label: '10 Cent', icon: 'ðŸª™' },
        { value: 0.05, label: '5 Cent', icon: 'ðŸª™' },
        { value: 0.02, label: '2 Cent', icon: 'ðŸª™' },
        { value: 0.01, label: '1 Cent', icon: 'ðŸª™' }
      ];

      let remaining = Math.round(amount * 100) / 100;
      const breakdown = [];

      denominations.forEach(denom => {
        const count = Math.floor(remaining / denom.value);
        if (count > 0) {
          breakdown.push({
            ...denom,
            count: count
          });
          remaining = Math.round((remaining - (count * denom.value)) * 100) / 100;
        }
      });

      if (breakdown.length === 0) return '';

      return `
        <div class="change-breakdown">
          <h3>ðŸ’° Change Breakdown:</h3>
          ${breakdown.map(item => `
            <div class="bill-row">
              <span>
                <span class="bill-icon">${item.icon}</span>
                ${item.label}
              </span>
              <span class="bill-count">${item.count}Ã—</span>
            </div>
          `).join('')}
        </div>
      `;
    }

    function showChangeAlert(message, type) {
      const alertArea = document.getElementById('changeAlertArea');
      if (!alertArea) return;

      const alert = document.createElement('div');
      alert.className = `change-alert change-alert-${type} show`;
      alert.textContent = message;
      alertArea.appendChild(alert);

      setTimeout(() => {
        alert.remove();
      }, 5000);
    }

    function playChangeSound() {
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
        oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.1);

        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);

        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.2);
      } catch (e) {
        // Ignore audio errors
      }
    }

    // Auto-calculate on Enter key and update calculator
    document.addEventListener('DOMContentLoaded', () => {
      const amountGivenInput = document.getElementById('changeAmountGiven');
      if (amountGivenInput) {
        amountGivenInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            calculateChange();
          }
        });
      }

      // Update change calculator when cart total changes
      const totalElement = document.getElementById('posTotal');
      if (totalElement) {
        // Initial update
        updateChangeCalculator();
        
        // Watch for changes to the total element
        const observer = new MutationObserver(() => {
          updateChangeCalculator();
        });

        observer.observe(totalElement, { 
          childList: true, 
          subtree: true, 
          characterData: true,
          attributes: false
        });

        // Also watch for changes to the entire cart list
        const cartList = document.getElementById('cartList');
        if (cartList) {
          const cartObserver = new MutationObserver(() => {
            setTimeout(updateChangeCalculator, 100);
          });
          cartObserver.observe(cartList, { 
            childList: true, 
            subtree: true 
          });
        }
      }
    });

    // Override renderCart to update change calculator (if pos.js is loaded after this)
    window.addEventListener('load', () => {
      // Try to hook into renderCart if it exists
      if (typeof renderCart === 'function') {
        const originalRenderCart = renderCart;
        window.renderCart = function() {
          originalRenderCart.apply(this, arguments);
          setTimeout(updateChangeCalculator, 50);
        };
      }
    });
  </script>
</body>
</html>


